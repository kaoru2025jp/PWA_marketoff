<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>STOCKOFF23 — 入力と計算・条文表示</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#357ab7" />

<style>
  body {
    font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    background: #f9f9f9;
    padding: 20px;
    color: #333;
  }
  h1 { text-align:center; color:#222; margin-bottom:6px; }
  .container { max-width:560px; margin:0 auto; }

  table {
    border-collapse: collapse;
    margin: 16px auto;
    width: 100%;
    max-width: 520px;
    background: #fff;
    box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    border-radius: 8px;
    overflow: hidden;
  }
  caption { font-weight:700; padding:12px 0; color:#444; }
  th, td { padding:10px 12px; text-align:center; border-bottom:1px solid #eee; }
  th { background: linear-gradient(135deg,#4a90e2,#357ab7); color:#fff; font-weight:700; }

  td.input {
    font-weight:700;
    color:#1b5e20;
    background:#e8f5e9;
    border-left:4px solid #43a047;
    border-right:4px solid #43a047;
  }
  td.middle { font-weight:700; color:#e65100; background:#fff3e0; }
  td.final {
    font-weight:700;
    color:#0d47a1;
    background:#e3f2fd;
    border-top:2px solid #64b5f6;
  }

  .clauses {
    color:#0d47a1;
    margin-top:18px;
    background:#fff;
    padding:12px;
    border-radius:8px;
    box-shadow:0 2px 6px rgba(0,0,0,0.05);
  }
  .clauses h2 { margin:0 0 8px 0; font-size:1.1em; }
  .clauses ol { margin:8px 0 0 18px; padding:0; }
  .clauses li { margin:6px 0; line-height:1.5; }

  .summary {
    margin-top:10px;
    background:#f6fbff;
    padding:10px;
    border-left:4px solid #64b5f6;
    border-radius:6px;
    color:#164a8a;
  }

  .pinBox {
    margin-top:12px;
    padding:12px;
    background:#eaf4ff;
    border:2px dashed #64b5f6;
    text-align:center;
    font-weight:700;
    color:#0d47a1;
    border-radius:6px;
    font-size:1.05em;
  }

  @media (max-width:520px){
    table{ width:100%; }
    .container{ padding:0 12px; }
  }
</style>
</head>

<body>
<div class="container">
  <h1>計算結果一覧（STOCKOFF23）</h1>
  <div id="output"></div>

<script>
  // --- 入力（prompt） ---
  var rawB  = prompt("Bを入力してください（例: 200）");
  var rawS  = prompt("Sを入力してください（例: 120）");
  var rawO1 = prompt("O1を入力してください（例: 555）");
  var rawO2 = prompt("O2を入力してください（例: 432）");
  var rawK  = prompt("Kを入力してください（例: 10）");

  var B  = Number(rawB);
  var S  = Number(rawS);
  var O1 = Number(rawO1);
  var O2 = Number(rawO2);
  var K  = Number(rawK);

  var D = B - S - O1 - O2;
  var denom = 0.95 * K - 1;
  var S2, S2str;

  if (!isFinite(denom) || Math.abs(denom) < 1e-12) {
    S2str = "計算不可（分母が0）";
  } else {
    S2 = (O1 - O2) / denom;
    S2str = Number(S2.toFixed(6));
  }

  alert("D = " + D);
  alert("S2 = " + S2str);

  var pinRaw = String(rawO1 || "") + String(rawO2 || "");
  var pin = pinRaw.replace(/\D/g, '') || "—";

  function escapeHtml(s) {
    if (s === null || s === undefined) return "";
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#39;");
  }

  document.getElementById("output").innerHTML = `
    <table>
      <caption>入力値と計算結果</caption>
      <tr><th>項目</th><th>値</th></tr>
      <tr><td>B</td><td class="input">${escapeHtml(rawB)}</td></tr>
      <tr><td>S</td><td class="input">${escapeHtml(rawS)}</td></tr>
      <tr><td>O1</td><td class="input">${escapeHtml(rawO1)}</td></tr>
      <tr><td>O2</td><td class="input">${escapeHtml(rawO2)}</td></tr>
      <tr><td>K</td><td class="input">${escapeHtml(rawK)}</td></tr>
      <tr><td>D</td><td class="middle">${D}</td></tr>
      <tr><td>S2</td><td class="final">${S2str}</td></tr>
    </table>

    <div class="clauses">
      <h2>条文（要旨）</h2>
      <ol>
        <li>証券と銘柄の交換にオプションを調整できる。</li>
        <li>仲介者は計算提案を行える。</li>
        <li>融資の斡旋は禁止される。</li>
        <li>買戻し特約付き取引にも同様に適用。</li>
        <li>担保不動産に条文内容を登記事項として残せる。</li>
      </ol>
    </div>

    <div class="summary">
      本案は証券取引におけるオプション調整の枠組みを定めたものです。
    </div>

    <div class="pinBox">暗証番号（O1＋O2）: ${pin}</div>
  `;
</script>
</div>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
